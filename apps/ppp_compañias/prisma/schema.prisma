generator client {
  provider = "prisma-client-js"
  output   = "../../../node_modules/.prisma/client-companias"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL_COMPANIAS")
}

/// =========================
///    EMPRESAS
/// =========================
model Empresa {
  id                  String              @id @default(uuid()) @db.Uuid
  nombre              String              @db.VarChar(255)
  nombreRepresentante String              @map("nombre_representante") @db.VarChar(255)
  ruc                 String              @unique @db.Char(11)
  sector              String              @db.VarChar(100)
  gradoAcademico      String              @map("grado_academico") @db.VarChar(100)
  cargoRepresentante  String              @map("cargo_representante") @db.VarChar(100)
  telefono            String              @db.VarChar(15)
  direccion           String
  createdAt           DateTime            @default(now()) @map("created_at")
  updatedAt           DateTime            @updatedAt @map("updated_at")
  cartasPresentacion  CartaPresentacion[]

  @@map("empresa")
}

/// =========================
///    TIPOS DE DOCUMENTO
/// =========================
model TipoDocumento {
  id          String      @id @default(uuid()) @db.Uuid
  nombre      String      @db.VarChar(100)
  descripcion String?
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")
  documentos  Documento[]

  @@map("tipo_documento")
}

/// =========================
///    DOCUMENTOS
/// =========================
model Documento {
  id              String              @id @default(uuid()) @db.Uuid
  idTipoDocumento String              @map("id_tipo_documento") @db.Uuid
  nombreArchivo   String              @map("nombre_archivo") @db.VarChar(255)
  rutaArchivo     String              @map("ruta_archivo")
  subidoPor       String?             @map("subido_por") @db.Uuid
  generadoPor     String?             @map("generado_por") @db.Uuid
  createdAt       DateTime            @default(now()) @map("created_at")
  updatedAt       DateTime            @updatedAt @map("updated_at")
  cartas          CartaPresentacion[]
  tipoDocumento   TipoDocumento       @relation(fields: [idTipoDocumento], references: [id])

  @@map("documento")
}

/// =========================
///    CARTAS DE PRESENTACIÃ“N
/// =========================
model CartaPresentacion {
  id            String      @id @default(uuid()) @db.Uuid
  idAlumno      String      @map("id_alumno") @db.Uuid
  idEmpresa     String      @map("id_empresa") @db.Uuid
  idSecretaria  String?     @map("id_secretaria") @db.Uuid
  documentoId   String?     @map("documento_id") @db.Uuid
  posicion      String      @db.VarChar(255)
  areaPractica  String      @map("area_practica") @db.VarChar(100)
  fechaInicio   DateTime    @map("fecha_inicio") @db.Date
  motivoRechazo String?     @map("motivo_rechazo")
  estado        CartaEstado @default(draft)
  submittedAt   DateTime?   @map("submitted_at") @db.Timestamptz(6)
  reviewedAt    DateTime?   @map("reviewed_at") @db.Timestamptz(6)
  createdAt     DateTime    @default(now()) @map("created_at")
  updatedAt     DateTime    @updatedAt @map("updated_at")
  documento     Documento?  @relation(fields: [documentoId], references: [id])
  empresa       Empresa     @relation(fields: [idEmpresa], references: [id])

  @@index([idAlumno])
  @@index([idEmpresa])
  @@index([idSecretaria])
  @@index([estado])
  @@map("carta_presentacion")
}

/// =========================
///    ENUMS
/// =========================
enum CartaEstado {
  draft
  submitted
  reviewing
  approved
  rejected
  cancelled
}
