generator client {
  provider = "prisma-client-js"
  output   = "../../../node_modules/.prisma/client-companias"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL_COMPANIAS")
}

/// =========================
///    EMPRESA
/// =========================
model Empresa {
  id                  String   @id @default(uuid()) @db.Uuid
  nombre              String   @db.VarChar(255)
  nombreRepresentante String   @map("nombre_representante") @db.VarChar(255)
  ruc                 String   @unique @db.Char(11)
  sector              String   @db.VarChar(100)
  gradoAcademico      String   @map("grado_academico") @db.VarChar(100)
  cargoRepresentante  String   @map("cargo_representante") @db.VarChar(100)
  telefono            String   @db.VarChar(15)
  direccion           String   @db.Text
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")

  solicitudes         SolicitudPpp[]
  cartasPresentacion  CartaPresentacion[]

  @@map("empresa")
}

/// =========================
///    SOLICITUD PPP
/// =========================
model SolicitudPpp {
  id           String          @id @default(uuid()) @db.Uuid
  idSupervisor String          @map("id_supervisor") @db.Uuid
  idAlumno     String          @map("id_alumno") @db.Uuid
  idEmpresa    String          @map("id_empresa") @db.Uuid
  estado       EstadoSolicitud @default(pendiente)
  createdAt    DateTime        @default(now()) @map("created_at")
  updatedAt    DateTime        @updatedAt @map("updated_at")

  empresa             Empresa             @relation(fields: [idEmpresa], references: [id], onDelete: Restrict)
  documentos          Documento[]
  cartaPresentacion   CartaPresentacion?
  reuniones           Reunion[]

  @@index([idSupervisor])
  @@index([idAlumno])
  @@index([idEmpresa])
  @@index([estado])
  @@map("solicitud_ppp")
}

/// =========================
///    CARTA DE PRESENTACIÃ“N
/// =========================
model CartaPresentacion {
  id            String         @id @default(uuid()) @db.Uuid
  idSolicitud   String?        @unique @map("id_solicitud") @db.Uuid
  idAlumno      String         @map("id_alumno") @db.Uuid
  idEmpresa     String         @map("id_empresa") @db.Uuid
  idSecretaria  String?        @map("id_secretaria") @db.Uuid
  areaPractica  String?        @map("area_practica") @db.VarChar(255)
  fechaInicio   DateTime       @map("fecha_inicio") @db.Date
  archivo       String?        @db.Text
  motivoRechazo String?        @map("motivo_rechazo") @db.Text
  estado        CartaEstado    @default(borrador)
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime       @updatedAt @map("updated_at")

  // Relations
  solicitud     SolicitudPpp?  @relation(fields: [idSolicitud], references: [id], onDelete: SetNull)
  empresa       Empresa        @relation(fields: [idEmpresa], references: [id], onDelete: Restrict)

  @@index([idAlumno])
  @@index([idEmpresa])
  @@index([idSecretaria])
  @@index([estado])
  @@map("carta_presentacion")
}

/// =========================
///    REUNIONES
/// =========================
model Reunion {
  id           String          @id @default(uuid()) @db.Uuid
  idSolicitud  String          @map("id_solicitud") @db.Uuid
  estado       EstadoReunion   @default(pendiente)
  createdAt    DateTime        @default(now()) @map("created_at")
  updatedAt    DateTime        @updatedAt @map("updated_at")

  solicitud SolicitudPpp @relation(fields: [idSolicitud], references: [id], onDelete: Cascade)

  @@index([idSolicitud])
  @@map("reuniones")
}

/// =========================
///    TIPO DOCUMENTO
/// =========================
model TipoDocumento {
  id          String      @id @default(uuid()) @db.Uuid
  nombre      String      @db.VarChar(100)
  descripcion String?     @db.Text
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")

  documentos Documento[]

  @@map("tipo_documento")
}

/// =========================
///    DOCUMENTO
/// =========================
model Documento {
  id              String   @id @default(uuid()) @db.Uuid
  idTipoDocumento String   @map("id_tipodocumento") @db.Uuid
  idSolicitudPpp  String   @map("id_solicitud_ppp") @db.Uuid
  nombreArchivo   String   @map("nombre_archivo") @db.VarChar(255)
  rutaArchivo     String   @map("ruta_archivo") @db.Text
  subidoPor       String?  @map("subido_por") @db.Uuid
  generadoPor     String?  @map("generado_por") @db.Uuid
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  tipoDocumento TipoDocumento @relation(fields: [idTipoDocumento], references: [id], onDelete: Restrict)
  solicitud     SolicitudPpp  @relation(fields: [idSolicitudPpp], references: [id], onDelete: Cascade)

  @@index([idSolicitudPpp])
  @@map("documento")
}

/// =========================
///    ENUMS
/// =========================
enum EstadoSolicitud {
  pendiente
  en_proceso
  aprobado
  rechazado
  cancelado
}

enum CartaEstado {
  borrador
  enviada
  aprobada
  rechazada
}

enum EstadoReunion {
  pendiente
  realizada
  cancelada
}
