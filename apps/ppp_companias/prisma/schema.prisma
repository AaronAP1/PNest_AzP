generator client {
  provider = "prisma-client-js"
  output   = "../../../node_modules/.prisma/client-companias"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL_COMPANIAS")
}

/// =========================
///    EMPRESA
/// =========================
model Empresa {
  id                  String   @id @default(uuid()) @db.Uuid
  nombre              String   @db.VarChar(255)
  nombreRepresentante String   @map("nombre_representante") @db.VarChar(255)
  ruc                 String   @unique @db.Char(11)
  sector              String   @db.VarChar(100)
  gradoAcademico      String   @map("grado_academico") @db.VarChar(100)
  cargoRepresentante  String   @map("cargo_representante") @db.VarChar(100)
  telefono            String   @db.VarChar(15)
  direccion           String   @db.Text
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")

  solicitudes         SolicitudPpp[]
  cartasPresentacion  CartaPresentacion[]

  @@map("empresa")
}

/// =========================
///    SOLICITUD PPP
/// =========================
model SolicitudPpp {
  id                    String          @id @default(uuid()) @db.Uuid
  idSupervisor          String          @map("id_supervisor") @db.Uuid // Referencia a ppp_auth.supervisores (sin @relation)
  idAlumno              String          @map("id_alumno") @db.Uuid // Referencia a ppp_auth.alumnos (sin @relation)
  idEmpresa             String          @map("id_empresa") @db.Uuid
  fechaInicio           DateTime?       @map("fecha_inicio") @db.Date
  fechaFin              DateTime?       @map("fecha_fin") @db.Date
  lugarRealizacion      String?         @map("lugar_realizacion") @db.VarChar(255)
  horarioTrabajo        String?         @map("horario_trabajo") @db.VarChar(100)
  horasPorSemana        Int?            @map("horas_por_semana")
  areaPracticante       String?         @map("area_practicante") @db.VarChar(255)
  estado                Int             @default(0) // 0=EN_PROCESO, 1=ASIGNADO, 5=FINALIZADO, 99=RECHAZADO
  createdAt             DateTime        @default(now()) @map("created_at")
  updatedAt             DateTime        @updatedAt @map("updated_at")

  empresa             Empresa             @relation(fields: [idEmpresa], references: [id], onDelete: Restrict)
  documentos          Documento[]
  reuniones           Reunion[]

  @@index([idSupervisor])
  @@index([idAlumno])
  @@index([idEmpresa])
  @@index([estado])
  @@map("solicitud_ppp")
}

/// =========================
///    CARTA DE PRESENTACIÃ“N
/// =========================
model CartaPresentacion {
  id            String         @id @default(uuid()) @db.Uuid
  idAlumno      String         @map("id_alumno") @db.Uuid // Referencia a ppp_auth.alumnos (sin @relation)
  idEmpresa     String         @map("id_empresa") @db.Uuid
  idSecretaria  String?        @map("id_secretaria") @db.Uuid // Referencia a ppp_auth.secretarias (sin @relation)
  areaPractica  String?        @map("area_practica") @db.VarChar(255)
  fechaInicio   DateTime       @map("fecha_inicio") @db.Date
  archivo       String?        @db.Text
  motivoRechazo String?        @map("motivo_rechazo") @db.Text
  estado        Int            @default(0) // 0=PENDIENTE, 1=EN_PROCESO, 5=ENTREGADO, 99=RECHAZADO
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime       @updatedAt @map("updated_at")

  // Relations
  empresa       Empresa        @relation(fields: [idEmpresa], references: [id], onDelete: Restrict)

  @@index([idAlumno])
  @@index([idEmpresa])
  @@index([idSecretaria])
  @@index([estado])
  @@map("carta_presentacion")
}

/// =========================
///    REUNIONES
/// =========================
model Reunion {
  id           String          @id @default(uuid()) @db.Uuid
  idSolicitud  String          @map("id_solicitud") @db.Uuid
  estado       Int             @default(0) // 0=PENDIENTE, 5=REALIZADA, 99=CANCELADA
  createdAt    DateTime        @default(now()) @map("created_at")
  updatedAt    DateTime        @updatedAt @map("updated_at")

  solicitud SolicitudPpp @relation(fields: [idSolicitud], references: [id], onDelete: Cascade)

  @@index([idSolicitud])
  @@map("reuniones")
}

/// =========================
///    TIPO DOCUMENTO
/// =========================
model TipoDocumento {
  id          String      @id @default(uuid()) @db.Uuid
  nombre      String      @db.VarChar(100)
  descripcion String?     @db.Text
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")

  documentos Documento[]

  @@map("tipo_documento")
}

/// =========================
///    DOCUMENTO
/// =========================
model Documento {
  id              String   @id @default(uuid()) @db.Uuid
  idTipoDocumento String   @map("id_tipodocumento") @db.Uuid
  idSolicitudPpp  String   @map("id_solicitud_ppp") @db.Uuid
  nombreArchivo   String   @map("nombre_archivo") @db.VarChar(255)
  rutaArchivo     String   @map("ruta_archivo") @db.Text
  subidoPor       String?  @map("subido_por") @db.Uuid // Referencia a ppp_auth.usuarios (sin @relation)
  generadoPor     String?  @map("generado_por") @db.Uuid // Referencia a ppp_auth.usuarios (sin @relation)
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  tipoDocumento TipoDocumento @relation(fields: [idTipoDocumento], references: [id], onDelete: Restrict)
  solicitud     SolicitudPpp  @relation(fields: [idSolicitudPpp], references: [id], onDelete: Cascade)

  @@index([idSolicitudPpp])
  @@map("documento")
}


